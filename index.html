<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Resonera: Era of Resonance ðŸŒ¸</title>
<script src="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
<style>
  body {
    background: #0b0d13;
    color: #bce;
    font-family: monospace;
    padding: 20px;
  }
  h2 {
    color: #9cf;
  }
  button {
    margin: 6px 0;
    padding: 6px 12px;
    border-radius: 6px;
    background: #5a2bff;
    color: #fff;
    border: none;
    cursor: pointer;
  }
  input, textarea {
    width: 100%;
    padding: 6px;
    margin: 4px 0;
    border-radius: 6px;
    border: 1px solid #333;
    background: #10131a;
    color: #bce;
  }
  svg {
    width: 240px;
    height: 240px;
    background: #000;
    border-radius: 8px;
    margin-top: 10px;
    display: block;
  }
  #randomIntention {
    margin: 12px 0;
    padding: 8px;
    border: 1px solid #333;
    border-radius: 6px;
    background: #10131a;
  }
</style>
</head>
<body>
<h2>Resonera: Era of Resonance ðŸŒ¸</h2>

<p><b>Random Intentions:</b></p>
<div id="randomIntention"></div>

<hr>

<p><b>Declare Your Intention</b></p>
<textarea id="intentionText" placeholder="Type your intention here..."></textarea>
<input type="email" id="userEmail" placeholder="Enter your email">
<button id="submitIntention">Generate & Send Lotus ðŸŒ¸</button>
<button id="downloadSVG">Download SVG</button>

<svg id="lotusSVG"></svg>

<p id="status"></p>

<script>
// ---------- Random intentions ----------
const safeIntentions = [
  "Grow in clarity and peace",
  "Attract abundance and joy",
  "Foster love and connection",
  "Manifest creativity",
  "Heal and forgive",
  "Radiate positivity",
  "Strengthen intuition",
  "Expand wisdom and knowledge"
];

function showRandomIntention() {
  const rand = safeIntentions[Math.floor(Math.random() * safeIntentions.length)];
  document.getElementById("randomIntention").textContent = rand;
}
setInterval(showRandomIntention, 5000);
showRandomIntention();

// ---------- Compression helpers ----------
function encodeShardData(obj) {
  const json = JSON.stringify(obj);
  const comp = pako.deflate(json, { level: 9 });
  return btoa(String.fromCharCode(...comp));
}

// ---------- Lotus generator ----------
let lastSVGCode = "";

function createLotusSVG(encoded) {
  const bytes = atob(encoded);
  const cx = 120, cy = 120;
  const baseR = 20;
  const step = (Math.PI * 4) / bytes.length;
  let angle = 0;
  let svg = "";

  for (let i = 0; i < bytes.length; i++) {
    const c = bytes.charCodeAt(i);
    const len = 20 + (c % 30);
    const width = 8 + (c % 8);
    const r = baseR + (c % 60);
    const x = cx + Math.cos(angle) * r;
    const y = cy + Math.sin(angle) * r;
    const x1 = x + Math.cos(angle - Math.PI/2) * width;
    const y1 = y + Math.sin(angle - Math.PI/2) * width;
    const x2 = x + Math.cos(angle + Math.PI/2) * width;
    const y2 = y + Math.sin(angle + Math.PI/2) * width;
    const tipX = x + Math.cos(angle) * len;
    const tipY = y + Math.sin(angle) * len;
    svg += `<path d="M${x1},${y1} Q${tipX},${tipY} ${x2},${y2} Z" fill="hsl(${(c*37)%360},70%,60%)" opacity="0.8"/>`;
    angle += step;
  }

  svg += `<circle cx="${cx}" cy="${cy}" r="12" fill="#5a2bff" stroke="#fff" stroke-width="0.8"/>`;
  const finalSVG = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240">${svg}</svg>`;
  document.getElementById("lotusSVG").innerHTML = finalSVG;
  lastSVGCode = finalSVG;
  return finalSVG;
}

// ---------- Download SVG ----------
document.getElementById("downloadSVG").onclick = () => {
  if (!lastSVGCode) {
    alert("Generate a lotus first.");
    return;
  }
  const blob = new Blob([lastSVGCode], { type: "image/svg+xml" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `resonera_lotus_${new Date().toISOString()}.svg`;
  a.click();
  URL.revokeObjectURL(url);
};

// ---------- EmailJS setup ----------
emailjs.init("sxtLbkp8ZtTAajZpu"); // ðŸª· using your original initialization value

// ---------- Send email ----------
document.getElementById("submitIntention").onclick = () => {
  const text = document.getElementById("intentionText").value.trim();
  const email = document.getElementById("userEmail").value.trim();
  if (!text) { alert("Enter an intention."); return; }
  if (!email) { alert("Enter your email."); return; }

  const shard = { text, date: new Date().toISOString() };
  const encoded = encodeShardData(shard);
  createLotusSVG(encoded);

  const templateParams = {
    user_email: email,
    intention_text: text,
    svg_content: lastSVGCode,
    cerbanimo_email: "glaedn@gmail.com"
  };

  emailjs.send("service_v9f0nc5", "template_puepa9m", templateParams, "sxtLbkp8ZtTAajZpu")
    .then(() => {
      document.getElementById("status").textContent =
        "ðŸŒ¸ Lotus generated & emailed! Check your inbox.";
    })
    .catch(err => {
      document.getElementById("status").textContent =
        "Error sending email. Try again.";
      console.error(err);
    });
};
</script>
</body>
</html>

